<!--components/todo-task-modal/index.wxml-->
<van-popup
  show="{{show}}"
  position="bottom"
  custom-style="height: 33%; border-radius: 20rpx 20rpx 0 0; background-color: {{themeColors ? themeColors.cardBg : '#F7EBD5'}};"
  bind:close="onClose"
  closeable
  close-icon-position="top-right"
>
  <view class="todo-task-modal theme-{{theme}}">
    <!-- 标题输入 -->
    <view class="input-section">
      <input
        class="title-input"
        value="{{taskTitle}}"
        placeholder="准备做什么?"
        bindinput="onTitleInput"
        maxlength="100"
        focus="{{show}}"
      />
    </view>

    <!-- 描述输入 -->
    <view class="input-section">
      <textarea
        class="description-input"
        value="{{taskDescription}}"
        placeholder="添加描述"
        bindinput="onDescriptionInput"
        maxlength="500"
        auto-height
      />
    </view>

    <!-- 底部操作栏 -->
    <view class="action-bar">
      <!-- 开始日期 -->
      <picker
        mode="date"
        value="{{startDate}}"
        start="{{minDate}}"
        end="{{maxDate}}"
        bindchange="onStartDateChange"
      >
        <view class="action-item">
          <van-icon name="calendar-o" size="20px" color="{{themeColors ? themeColors.darkAccent : '#B22A2A'}}" />
          <text class="action-text">{{startDate || '开始日期'}}</text>
        </view>
      </picker>

      <!-- 结束日期 -->
      <picker
        mode="date"
        value="{{endDate || startDate}}"
        start="{{endDateMin}}"
        end="{{maxDate}}"
        bindchange="onEndDateChange"
      >
        <view class="action-item">
          <van-icon name="calendar-o" size="20px" color="{{themeColors ? themeColors.darkAccent : '#B22A2A'}}" />
          <text class="action-text">{{endDate || '结束日期'}}</text>
        </view>
      </picker>

      <!-- 颜色选择 -->
      <view class="action-item" bindtap="onColorTap">
        <view class="color-dot" style="background-color: {{selectedColor}}"></view>
        <text class="action-text">选择颜色</text>
      </view>

      <!-- 发送按钮 -->
      <view class="send-button" bindtap="onSave">
        <van-icon name="send" size="24px" color="#ffffff" />
      </view>
    </view>

  </view>
</van-popup>

<!-- 颜色选择弹窗 -->
<van-popup
  show="{{showColorPicker}}"
  position="bottom"
  bind:close="onColorPickerClose"
  custom-style="height: 50%; border-radius: 20rpx 20rpx 0 0; background-color: {{themeColors ? themeColors.cardBg : '#F7EBD5'}};"
>
  <view class="color-picker theme-{{theme}}">
    <view class="picker-header">
      <text class="picker-title">选择颜色</text>
      <van-icon name="cross" size="20px" color="{{themeColors ? themeColors.darkAccent : '#B22A2A'}}" bindtap="onColorPickerClose" />
    </view>
    <view class="color-grid">
      <view
        wx:for="{{colorOptions}}"
        wx:key="index"
        class="color-item {{selectedColor === item ? 'selected' : ''}}"
        style="background-color: {{item}}"
        data-color="{{item}}"
        bindtap="onColorSelect"
      >
        <van-icon wx:if="{{selectedColor === item}}" name="success" size="20px" color="#ffffff" />
      </view>
    </view>
  </view>
</van-popup>

