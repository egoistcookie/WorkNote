<!--pages/todo-manage/index.wxml-->
<view class="todo-manage-page theme-{{theme}}">
  <view class="header">
    <text class="title">待办管理</text>
    <text class="task-count">共 {{allTasks.length}} 条</text>
  </view>

  <view class="filter-tabs">
    <view 
      class="filter-tab {{filterStatus === 'all' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="all"
    >
      全部
    </view>
    <view 
      class="filter-tab {{filterStatus === 'pending' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="pending"
    >
      未完成
    </view>
    <view 
      class="filter-tab {{filterStatus === 'completed' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="completed"
    >
      已完成
    </view>
  </view>

  <view class="task-list">
    <view 
      class="task-item {{item.status === 'completed' ? 'completed' : ''}}" 
      wx:for="{{filteredTasks}}" 
      wx:key="id"
    >
      <view class="task-header">
        <view class="task-title-wrapper">
          <view 
            class="task-checkbox {{item.status === 'completed' ? 'checked' : ''}}"
            bindtap="onToggleStatus"
            data-id="{{item.id}}"
          >
            <van-icon 
              wx:if="{{item.status === 'completed'}}"
              name="success" 
              size="16px" 
              color="#ffffff" 
            />
          </view>
          <text class="task-title">{{item.title}}</text>
        </view>
        <view class="task-actions">
          <van-icon 
            name="delete-o" 
            size="18px" 
            color="#ee0a24" 
            bindtap="onDeleteTask"
            data-id="{{item.id}}"
          />
        </view>
      </view>
      
      <view class="task-description" wx:if="{{item.description}}">
        {{item.description}}
      </view>
      
      <view class="task-meta">
        <text class="task-priority">{{getPriorityText(item.priority)}}</text>
        <text class="task-date" wx:if="{{item.startDate || item.endDate}}">
          {{item.startDate || ''}} {{item.startDate && item.endDate ? '-' : ''}} {{item.endDate || ''}}
        </text>
      </view>
    </view>
    
    <view class="empty-state" wx:if="{{filteredTasks.length === 0}}">
      <van-icon name="info-o" size="48px" color="#c8c9cc" />
      <text class="empty-text">暂无待办任务</text>
    </view>
  </view>

  <!-- 删除确认弹窗 -->
  <van-dialog
    show="{{showDeleteConfirm}}"
    title="确认删除"
    message="确定要删除这条待办任务吗？"
    show-cancel-button
    bind:confirm="onConfirmDelete"
    bind:cancel="onCancelDelete"
  />
</view>

